!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Tview=t()}(this,function(){"use strict";function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var a=function(){function e(){o(this,e),this.subs=[]}return t(e,[{key:"addSub",value:function(e){this.subs.push(e)}},{key:"removeSub",value:function(e){!function(e,t){if(e.length){var n=e.indexOf(t);if(-1<n)e.splice(n,1)}}(this.subs,e)}},{key:"depend",value:function(){window.target&&this.addSub(window.target)}},{key:"notify",value:function(){for(var e=this.subs.slice(),t=0,n=e.length;t<n;t++)e[t].update()}}]),e}();function u(e,t,n,r){Object.defineProperty(e,t,{value:n,enumerable:!!r,writable:!0,configurable:!0})}var i=Object.prototype.hasOwnProperty;var e=Array.prototype,s=Object.create(e);["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(o){var a=e[o];u(s,o,function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];var n,r=a.apply(this,t),i=this.__ob__;switch(o){case"push":case"unshift":n=t;break;case"splice":n=t.slice(2)}return n&&i.observeArray(n),i.dep.notify(),r})});var f="__proto__"in{},l=Object.getOwnPropertyNames(s),h=function(){function n(e,t){(o(this,n),this.value=e,this.dep=new a,u(e,"__ob__",this),this.vm=t,Array.isArray(e))?((f?v:p)(e,s,l),this.observeArray(e)):this.walk(e)}return t(n,[{key:"walk",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)d(e,t[n])}},{key:"observeArray",value:function(e){for(var t=0,n=e.length;t<n;t++)y(e[t])}}]),n}();function d(e,t,n){2===arguments.length&&(n=e[t]),"object"===c(n)&&new h(n);var r=y(n),i=new a;Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return i.depend(),r&&r.dep.depend(),n},set:function(e){n!==e&&(n=e,i.notify())}})}function v(e,t,n){e.__proto__=t}function p(e,t,n){for(var r=0,i=n.length;r<i;r++){var o=n[r];u(e,o,t[o])}}function y(e){var t,n,r;if(null!==(t=e)&&"object"===c(t))return n=e,r="__ob__",i.call(n,r)&&e.__ob__ instanceof h?e.__ob__:new h(e)}var m=function(){function r(e,t,n){o(this,r),this.vm=e,this.cb=n,this.getter=function(e){if(b.test(e))return;var n=e.split(".");return function(e){for(var t=0;t<n.length;t++){if(!e)return;e=e[n[t]]}return e}}(t),this.value=this.get()}return t(r,[{key:"get",value:function(){var e=(window.target=this).vm,t=this.getter.call(e,e);return window.target=void 0,t}},{key:"update",value:function(){var e=this.value;this.value=this.get(),this.cb.call(this.vm,this.value,e)}}]),r}(),b=/[^\w.$]/;var g=document,n=function(){function n(e,t){o(this,n),this.$el=g.querySelector(e),this.$vm=t,this.$el&&(this.$fragment=this.node2Fragment(this.$el),this.compile(this.$fragment),this.$el.appendChild(this.$fragment))}return t(n,[{key:"node2Fragment",value:function(e){for(var t,n=g.createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}},{key:"compile",value:function(e){var a=this,t=e.childNodes;Array.from(t).forEach(function(o){if(a.isElement(o)){var e=o.attributes;Array.from(e).forEach(function(e){var t=e.name,n=e.value;if(a.isDirective(t)){var r=t.substring(2);console.log(o.childNodes),a[r]&&a[r](o,a.$vm,n)}if(a.isEvent(t)){var i=t.substring(1);a.eventHandler(o,a.$vm,n,i)}})}else a.isInterpolation(o)&&a.compileText(o);o.childNodes&&0<o.childNodes.length&&a.compile(o)})}},{key:"compileText",value:function(e){console.log(e,this.$vm,RegExp.$1),this.update(e,this.$vm,RegExp.$1,"text")}},{key:"update",value:function(t,e,n,r){var i=this[r+"Updater"];i&&i(t,e[n]);var o=new m(e,n,function(e){i&&i(t,e)});e._watchers.push(o)}},{key:"text",value:function(e,t,n){this.update(e,t,n,"text")}},{key:"model",value:function(e,t,n){this.update(e,t,n,"model"),e.addEventListener("input",function(e){t[n]=e.target.value})}},{key:"modelUpdater",value:function(e,t){e.value=t}},{key:"html",value:function(e,t,n){this.update(e,t,n,"html")}},{key:"htmlUpdater",value:function(e,t){e.innerHTML=t}},{key:"for",value:function(e,t,n){this.update(e,t,n,"for")}},{key:"forUpdater",value:function(e,t){e.textContent=t}},{key:"textUpdater",value:function(e,t){if(Array.isArray(t)){var i=[];!function r(e){e.forEach(function(e){var t="";for(var n in e)Array.isArray(e[n])?r(e[n]):(t+="{".concat(n,"ï¼š").concat(e[n],"}"),i.push(t))})}(t),e.textContent="["+i.join(",")+"]"}else e.textContent=t}},{key:"eventHandler",value:function(e,t,n,r){var i=t.$options.methods&&t.$options.methods[n];r&&i&&e.addEventListener(r,i.bind(t))}},{key:"isDirective",value:function(e){return 0==e.indexOf("t-")}},{key:"isEvent",value:function(e){return 0==e.indexOf("@")}},{key:"isElement",value:function(e){return 1===e.nodeType}},{key:"isInterpolation",value:function(e){return 3===e.nodeType&&/\{\{(.*)\}\}/.test(e.textContent)}}]),n}(),k=function(){function i(e,t,n){o(this,i),this.tagName=e,this.data=t,this.children=n,this.key=t&&t.key,this.count=this.getCount(n)}return t(i,[{key:"getCount",value:function(n){var r=0;return n.forEach(function(e,t){e instanceof i?r+=e.count:n[t]=""+e,r++}),r}}]),i}();k.prototype.render=function(){var n=document.createElement(this.tagName),e=this.data,t=this.children||[];for(var r in e){var i=e[r];n.setAttribute(r,i)}return t.forEach(function(e){var t=e instanceof k?e.render():document.createTextNode(e);n.appendChild(t)}),n};var w=0,_=1,x=2,E=3;function A(e,t){!function e(t,n,r){var i=r[n.index];var o=t.childNodes?t.childNodes.length:0;for(var a=0;a<o;a++){var u=t.childNodes[a];n.index++,e(u,n,r)}i&&(s=t,i.forEach(function(e){switch(e.type){case w:var t="string"==typeof e.node?document.createTextNode(e.node):e.node.render();s.parentNode.replaceChild(t,s);break;case _:r=s,n=e.moves,i=Array.from(r.childNodes),o={},i.forEach(function(e){if(1===e.nodeType){var t=e.getAttribute("key");t&&(o[t]=e)}}),n.forEach(function(e){var t=e.index;if(0===e.type)i[t]===r.childNodes[t]&&r.removeChild(r.childNodes[t]),i.splice(t,1);else if(1===e.type){var n=o[e.item.key]?o[e.item.key].cloneNode(!0):"object"===c(e.item)?e.item.render():document.createTextNode(e.item);i.splice(t,0,n),r.insertBefore(n,r.childNodes[t]||null)}});break;case x:!function(e,t){for(var n in t)if(t[n]){var r=t[n];N(e,n,r)}else e.removeAttribute(n)}(s,e.props);break;case E:s.textContent=e.content;break;default:throw new Error("Unknown patch type "+e.type)}var r,n,i,o}));var s}(e,{index:0},t)}function N(e,t,n){switch(t){case"style":e.style.cssText=n;break;case"value":var r=e.tagName||"";"input"===(r=r.toLowerCase())||"textarea"===r?e.value=n:e.setAttribute(t,n);break;default:e.setAttribute(t,n)}}function O(e,t){for(var n={},r=[],i=0,o=e.length;i<o;i++){var a=e[i],u=$(a,t);u?n[u]=i:r.push(a)}return{keyIndex:n,free:r}}function $(e,t){if(e&&t)return"string"==typeof t?e[t]:t(e)}A.REPLACE=w,A.REORDER=_,A.PROPS=x,A.TEXT=E;var C={makeKeyIndexAndFree:O,diff:function(e,t,n){for(var r,i,o=O(e,n),a=O(t,n),u=a.free,s=o.keyIndex,c=a.keyIndex,f=[],l=[],h=0,d=0;h<e.length;){if(i=$(r=e[h],n))if(c.hasOwnProperty(i)){var v=c[i];l.push(t[v])}else l.push(null);else{var p=u[d++];l.push(p||null)}h++}var y=l.slice(0);for(h=0;h<y.length;)null===y[h]?(k(h),_(h)):h++;for(var m=h=0;h<t.length;){i=$(r=t[h],n);var b=y[m],g=$(b,n);if(b)if(i===g)m++;else if(s.hasOwnProperty(i))$(y[m+1],n)===i?(k(h),_(m),m++):w(h,r);else w(h,r);else w(h,r);h++}function k(e){var t={index:e,type:0};f.push(t)}function w(e,t){var n={index:e,item:t,type:1};f.push(n)}function _(e){y.splice(e,1)}return{moves:f,children:l}}}.diff;function P(e,t,n,r){var i,o=[];if("string"==typeof e&&"string"==typeof t)t!==e&&o.push({type:A.TEXT,content:t});else if(null!=t&&e.tagName===t.tagName&&e.key===t.key){var a=function(e,t){var n=0,r=e.props,i=t.props,o={};for(var a in r)i[a]!==r[a]&&(n++,o[a]=i[a]);for(var a in i)r.hasOwnProperty(a)||(n++,o[a]=i[a]);return 0!==n?o:null}(e,t);a&&o.push({type:A.PROPS,props:a}),(i=t).props&&i.props.hasOwnProperty("ignore")||function(e,n,t,r,i){var o=C(e,n,"key");if(n=o.children,o.moves.length){var a={type:A.REORDER,moves:o.moves};i.push(a)}var u=null,s=t;e.forEach(function(e,t){P(e,n[t],s=u&&u.count?s+u.count+1:s+1,r),u=e})}(e.children,t.children,n,r,o)}else null!==t&&o.push({type:A.REPLACE,node:t});o.length&&(r[n]=o)}var T={el:function(e,t,n){return new k(e,t,n)},diff:function(e,t){var n={};return P(e,t,0,n),n},patch:A};function j(e){e._watchers=[],e.$options.data?function(e){var t=e.$options.data;t=e._data="function"==typeof t?t.call(e):t||{};var n=Object.keys(t),r=n.length;for(;r--;)R(e,n[r]);y(t)}(e):y(e._data={})}function R(t,n){Object.defineProperty(t,n,{configurable:!0,enumerable:!0,get:function(){return t._data[n]},set:function(e){t._data[n]=e}})}window.vd=T;return function e(t){o(this,e),this.$options=t,this.$data=t.data,j(this),new h(this.$data,this),new n(t.el,this),t.created&&t.created.call(this)}});
//# sourceMappingURL=Tview.min.js.map
